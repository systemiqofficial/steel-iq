# Agent Logic

## Furnace-Group Strategy Evaluation
At its core, the furnace-group strategy evaluation is how each individual production unit (i.e., each furnace group) decides whether to keep operating as is, upgrade its technology, renovate, or close entirely. The process begins by checking the plant-level balance — if negative, no action is taken. It also skips any units already in "operating pre-retirement" status.

Next, it checks whether historic losses exceed a critical threshold: the capital expenditure multiplied by the unit's capacity. If this write-off point is breached, it issues a closure command. Otherwise, it calculates the net present value (NPV) for each allowed technology transition — including staying with the current technology. This NPV calculation first determines the Cost of Stranded Assets (COSA) by taking the maximum of remaining debt and economic COSA. For each allowed technology, it applies available subsidies (capex, opex, and debt), determines whether the transition would be a brownfield renovation (same technology) or greenfield installation (new technology), retrieves or calculates the bill of materials and emissions profile, then computes the NPV including carbon costs and operating subsidies. For technology switches, the NPV is adjusted downward by subtracting COSA, which represents the penalty for abandoning current equipment.

Once NPVs are computed, the agent selects a technology: either deterministically (highest NPV) or probabilistically (weighted random based on NPVs). If no technology option is profitable (all NPVs ≤ 0), no action is taken. If the selected technology is the current one and the unit's lifetime has expired, it may trigger a renovation; if a different technology is selected, it evaluates a technology switch. All decisions respect capacity limits and affordability constraints, yielding a single command (or none) per furnace group each year.

## Plant-Group Expansion Consideration
Once individual furnace groups have made their operating decisions, the model steps back to the level of the entire plant cluster (a plant group). Here the question is: "Should this group add new capacity?" To answer that, it evaluates NPV-optimal technology choices for each plant in the group, considering location-specific costs, allowed technologies, and active subsidies (capex, opex, debt). This evaluation accounts for technology-specific constraints — such as requiring a hot-metal furnace for BOF - and incorporates carbon costs based on technology emission factors and carbon price trajectories.

The plant-group then selects the expansion option with the highest NPV, verifies it is positive and profitable, and checks whether the group's balance can cover the equity requirement. Expansion decisions can be either deterministic (accept if profitable) or probabilistic (weighted by investment-to-NPV ratio). Before approving the expansion, the model enforces capacity limits that distinguish between new plants and expansions/switches, ensuring each product type (iron or steel) respects its allocation targets. If all checks pass — profitability, affordability, capacity limits, and probabilistic acceptance — the group issues an AddFurnaceGroup command. Otherwise, it holds its current footprint. This expansion loop ensures simulated industry growth is economically justified and respects both financial constraints and sector-level capacity policies.

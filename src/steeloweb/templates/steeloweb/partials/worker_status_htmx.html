<div class="card mb-3" id="worker-status-card">
    <div class="card-header bg-info text-white">
        <div class="d-flex justify-content-between align-items-center">
            <button class="btn btn-sm btn-link text-white text-decoration-none p-0" 
                    data-bs-toggle="collapse" 
                    data-bs-target="#worker-status-collapse" 
                    aria-expanded="false" 
                    aria-controls="worker-status-collapse">
                <h5 class="mb-0">
                    <i class="fas fa-server me-2"></i> Worker Status
                    <i class="fas fa-chevron-down ms-2" id="worker-status-chevron"></i>
                </h5>
            </button>
            <button class="btn btn-sm btn-light" 
                    hx-get="{% url 'worker-status-htmx' %}"
                    hx-target="#worker-status-content"
                    hx-swap="innerHTML">
                <i class="fas fa-sync-alt" id="refresh-icon"></i> Refresh
            </button>
        </div>
    </div>
    <div class="collapse" id="worker-status-collapse">
        <div class="card-body">
        <!-- Content that gets updated by HTMX -->
        <div id="worker-status-content"
             hx-get="{% url 'worker-status-htmx' %}"
             hx-trigger="load, every 5s[document.getElementById('worker-status-collapse').classList.contains('show')]"
             hx-swap="innerHTML">
            <!-- Initial loading state -->
            <div class="text-center">
                <i class="fas fa-spinner fa-spin"></i> Loading worker status...
            </div>
        </div>

        <!-- Loading indicator for manual actions only (outside swap region to prevent flicker) -->
        <div id="manual-worker-loading" class="htmx-indicator">
            <div class="text-center mt-2">
                <i class="fas fa-spinner fa-spin"></i> Updating workers...
            </div>
        </div>

        <!-- Hidden element that calls the tick endpoint to update worker states -->
        <div id="worker-tick-trigger"
             hx-post="{% url 'workers-tick' %}"
             hx-trigger="every 5s[document.getElementById('worker-status-collapse').classList.contains('show')]"
             hx-swap="none"
             style="display: none;">
        </div>
        </div>
    </div>
</div>

<!-- HTMX loading indicator styles -->
<style>
.htmx-indicator {
    display: none;
}
.htmx-request .htmx-indicator {
    display: block;
}
.htmx-request.htmx-indicator {
    display: block;
}
/* Refresh button loading animation */
.htmx-request #refresh-icon {
    animation: spin 1s linear infinite;
}
@keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}
/* Collapsible chevron animation */
#worker-status-chevron {
    transition: transform 0.3s ease;
}
button[aria-expanded="true"] #worker-status-chevron {
    transform: rotate(180deg);
}
</style>